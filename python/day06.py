from typing import Optional, Literal
from typing_extensions import Self

map_string: str = "..#....##....................#...#...#..........................................................................................#.|.....#..............................................#....#.....#.....#..............................#.......#...#.............#...|............#.#.........................................#...................#..#...........................###..........#.....#...|.....#.....#.............#...........................................................#.#.................#.........#..............|.......................#...........................#................#...........#......#.....................#...#.......#....#...|...#........................................#....................#.......#........##.##.........#.........................#.......|......#...........#....................#...........#.............................#........................#....................#..|...........................#...................................#...............#.........................................#........|........#...........#................................................................#............#...............................|.........................#......#.......#..............#......#.................#..................#...................#..........|............#......................................................#..............................#........#....#.................|........#.....................................................................#..............#....................................|..#............................#.................#.#............#.................................................................|...#................#.....................#.................................................#...................#.................|......#...................#........................................................................................#..#...........|.....................##..#........................................#...................#............#.....#........................|.......#.................#..........#...........................#.......#..............#..........................................|.............#........#........#..........#................#.........#.##.................................#.......#...........#...|.#..............................................................#..#.....................................#.................##.....|.........................#.#.......#.#..................................................#....................#.......#.........#..|.............#................................................#..#................#.............#.....#...........................|.............................................#..............#.....#..............#.........#......................................|................#............#............................#...........#.#.........................................................|...#.................................#.......#.........................................#..........................................|...............................#.....................................................................#.....#.........##...........|...................#...................................#.....................#.............................#..#...#...............|......#.......................................................#............................#......#.................#.#...........|...........................................#........................#.........#........................##......#..................|....#.......................#...................#.....#....................#......................................................|.....#......#....#..........#............#........#...............................................................................|.........#.................................................................................#........#.........................#...|........................#................................#........#...#......#........#..........#.#.......#.........#.........#.#|.##......#..#......#............#.#.................................#..............................#.........#....................|......#..............................#..........#.........#.....#....................................#...........................#|..#.........................#.#...#............................................#.#.......................................##.......|#.........................#......................#.............#..#.#...#....#.....#.#...#......#........................#........|.#............................#.................................#....#..............................#........#..........#.........|..........#.........#.....#.....#......................#............................................#.............................|.........................#...#.............................#..............................................#......#.#..............|....................#................................................................................................#............|...#........#......................#..#...........#..#.........#.................................................#................|...................#....................#..............#......................#..............#........#......................#....|.............#..................................................................................#................#.....##.........|.#.............................#........#................#..#..#.....#...........###..............................................|.......................................................#.........................#.............................#..................|...........................##.............#.........................................................#.......................#.....|......#.......##.........#..................................................................#.#..#.........#.........#.......#....|..#...........#..........#........#....#..........#..................#.............#.............#................................|#................................##...........#......#....##......#..#.....................................#.........#..#.........|...#...#.#.......................#......................................#.........#......#...............#........................|..#...#.......................................................#..................#.........................................#......|...#.....#.....#..........#....................#..................#.........................#...............#...#..#....#.........|..........#................................#...................#..#...........#.........#....................................#....|..............#........#............................#..................................................................#........#.|............................................................#.....##.................................#............................|...##..............................................#..........................................#.............................#.##..|...#...........................................................................#......#.....................#.#...................|.........#.............................................................................##.....................................#.#.|...............#.....#........#..#................................................................................................|#...........................#.#..............................#........^......#.................................#.....#............|...#...#.........................................#......................#.#.......................................................|.#......#...........................#.............................................................................................|.....#.........#.......#..#........#.....#.....................#......#........................................#...#..............|....#....................................................................................................#........................|#..............#.......................#.........................................#...............................#.#..............|................................#..............................#.......................................................#....#.....|....#............................#............................................................#.....#........#...................#|...........#...#............................#....................#.......................................................#........|.#.....................................................................................................#.....#....................|.#.......#..............#.....................#.....................#............#........................#.......................|............................#...#................................................#................................#...............|..........#...............#..........................#................#.........................#.......#.#.......................|..............................#.............................................................................................#.....|..............................................#....#...............................................#.....#........................|.........#...................................................#...............#.....#................#.............................|...........................................#..............#....................................................#........#.#.......|..........................#...........#.#...#.....................................#......................#...........#..#.........|....#...............#..............#.............................#....#.....#....#................................................|....#.#...........#..............#.................................................................#..............................|.....#.......#..........................................................................................#.#.......................|................................................#..#..............................................................................|.#....#..............................#..........#................#.............................................................#..|....#.......................#........#.....#..............#...............#..#........................................#...........|...........................................................................#......................................................|...#.........#..#.......................................................#..#..............................#.......................|.............#...................................................................#.......................#...#...........#........|.....#........................#....................#...................#................................#.........................|.........#......#...........................................#.......#....................#........................................|...........................................................#...........................#.............................#............|..........................#..............#........................................#......#.........#.#.............#........#.....|.........#..............#..#...........................#......#.......................#..#..#.............#.......................|...#.................#...............................................................................................#............|................#.....#.#...........................#......................#....................................#...#.#...........|..................#.....#...............................................................#............................#....#..#....|...............................#................................................#.............#..........................#........|..#...........#................................................#.........................................#...............##......#|...............................#..................##..#...........................................#................#..............|...........................#........#.........#....................................................#......#......#................|..................................#................#..................#.....#..................#...................#.....#........|.......#...#................................................................##...........................................#........|..............#..#.......#............................#...................#....#...........................#..#......#............|...............#............#................................................................................#..............#.....|...............#.....#........................#.........#.........#...#................#....#.........#...........................|................................#........................................................................#.........#..............|.............#..................#...#................................#..............#................................#.........#..|.....................#.#.............................#......#..................................#.........##....#.................#|......#.........#...#.................................#..........#.#......................#.......#........#......................|.....#....................#......................#.........#.....................#.........................................#......|.........##.....................#....#.#....#....................................................................................#|.................................................#.#....#....................#...............##..#................................|..##.......#........#.......................#.....................................................................#...........#.##|..#...........##........##......#..........#....................#.....#.....#..................#.....#............................|..........................#.......................#.....#.........................................................................|.#...........................#..............#...#...........#.....#.......#....#............#.....#..................#....#......#|.................#.......................#....#...#..................#......#............................#.....................#..|.....##..#........#........................#......#........................#....#......................##.........................|...#....................................................................................................#.......................#.|.......................#...#..............#..................#............#.#.........#....#...#..................................|...........#.......................#.......................#.......#....#.....#..................#...................#............|..................#......................................................................#.......#..........................#.....|.......#..................#.............#..#........##........#..##........##.....##...#................#..#.......#..............|........#................#..............................#..#......................................................................|...................#....#.........................#...........#.#......##.........#.#..................#..#.#....#........#.......|.............#......#.....................................................#.......................................................|.........................#.......................#..................#.........................#...............................#..#|..#...........................#............#.................##...#................#.................#................#...........|.....#...............#.....#..........#..................................#.#........................#.....###.#...................|...............................................#.............#......................................................#.............|......#......................#..............#.................#.#........#.................#......................................|........................#.......................................#....................#.......#.#..#..............................."

class Coordinate:
    char: str
    n: Optional[Self] = None
    e: Optional[Self] = None
    w: Optional[Self] = None
    s: Optional[Self] = None

    def __init__(self, char: str):
        self.char = char


def parse_map(map_string: str) -> list[list[Coordinate]]:
    map = []

    chars: list[list[str]] = [list(line) for line in map_string.split("|")]

    for i in range(len(chars)):
        map.append([])
        for j in range(len(chars[i])):
            coord = Coordinate(chars[i][j])
            if i-1 >= 0:
                coord.n = map[i-1][j]
                coord.n.s = coord
            if j-1 >= 0:
                coord.w = map[i][j-1]
                coord.w.e = coord
            map[i].append(coord)

    return map


def get_guard_path(coords: list[list[Coordinate]]) -> Optional[set[Coordinate]]:
    path = set()

    location = [x for xs in coords for x in xs if x.char == "^"][0]
    direction: Literal["n", "w", "e", "s"] = "n"

    step = 0
    step_limit = len([x for xs in coords for x in xs]) * 4

    while True:
        path.add(location)

        match direction:
            case "n": next = location.n
            case "e": next = location.e
            case "s": next = location.s
            case "w": next = location.w

        if next is None:
            return path

        if next.char == "#":
            match direction:
                case "n": direction = "e"
                case "e": direction = "s"
                case "s": direction = "w"
                case "w": direction = "n"
        else:
            location = next
            step += 1
            if step > step_limit:
                return None


problem1Solution = len(get_guard_path(parse_map(map_string)))
problem2Solution = len([i for i in range(len(map_string)) if map_string[i] == "." and get_guard_path(parse_map(map_string[0:i] + "#" + map_string[i+1:])) is None])

print(problem1Solution)
print(problem2Solution)
